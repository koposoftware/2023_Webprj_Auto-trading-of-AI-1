<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="com.hanaonestock.stock.model.dto.RecommendedStock" %>
<%@ page import="java.util.List" %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="../../resources/style/common.css">
    <link rel="stylesheet" href="../../resources/style/dashboard.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        var cash;
    </script>
</head>
<body>
<body style="background-image: url(" ..
/img/background2.png")">
<%@ include file="include/header.jsp" %>
<div class="main">
    <div class="search-menu">
        <div class="a">
            <input class="search-box" type="text" placeholder="üîç SEARCH">
            <button class="search-button" onclick="handleSearch()">Í≤ÄÏÉâ</button>
            <div class="search-result"></div>
        </div>
    </div>
</div>
<div class="content">
    <div class="content-container">
        <!-- ÏôºÏ™Ω ÏÑúÎ∏å Î©îÎâ¥ -->
        <div class="left_sub_menu">
            <div class="sub_menu">
                <h2>üìä Ï∂îÏ≤úÏ¢ÖÎ™©</h2>
                <c:forEach var="stock" items="${sessionScope.stockList}">
                    <ul class="stock_name">
                        <li><c:out value="${stock.name}"/><i class="arrow fas fa-angle-right"></i></li>
                        <ul class="small_menu">
                            <li>Ï¢ÖÎ™©Î≤àÌò∏ <c:out value="${stock.isin}"/></li>
                            <li><c:out value="${stock.close}"/> <c:choose>
                                <c:when test="${stock.updown >= 0}">
                                    <span class="blue_text">+<c:out value="${stock.updown}"/>%</span>
                                </c:when>
                                <c:otherwise>
                                    <span class="red_text"><c:out value="${stock.updown}"/>%</span>
                                </c:otherwise>
                            </c:choose>
                            </li>
                        </ul>
                    </ul>
                </c:forEach>
                <!-- Ï¢ÖÎ™© Ï∂îÍ∞Ä ÎàÑÎ•¥Î©¥ ÌòÑÏû¨ Ï¢ÖÎ™© Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä -->
                <h2>‚úÖ Ï¢ÖÎ™©Ï∂îÍ∞Ä</h2>
                <div class="add_stock"></div>
            </div>
        </div>
        <div class="chart_div">
            <div class="stock" style="margin-top: 15px;">
                Ï¢ÖÎ™©Ïù¥Î¶Ñ(Ï¢ÖÎ™©ÏΩîÎìú)
            </div>
            <div class="chart">
                <script>
                    var chart = LightweightCharts.createChart(document.querySelector('.chart'), {
                        width: 750,
                        height: 350,
                        rightPriceScale: {
                            visible: true,
                            borderColor: 'rgba(197, 203, 206, 1)',
                        },
                        leftPriceScale: {
                            visible: true,
                            borderColor: 'rgba(197, 203, 206, 1)',
                        },
                        layout: {
                            backgroundColor: '#ffffff',
                            textColor: 'rgba(33, 56, 77, 1)',
                        },
                        grid: {
                            horzLines: {
                                color: '#F0F3FA',
                            },
                            vertLines: {
                                color: '#F0F3FA',
                            },
                        },
                        crosshair: {
                            mode: LightweightCharts.CrosshairMode.Normal,
                        },
                        timeScale: {
                            borderColor: 'rgba(197, 203, 206, 1)',
                        },
                        handleScroll: {
                            vertTouchDrag: false,
                        },
                    });

                    const candlestickSeries = chart.addCandlestickSeries({priceScaleId: 'left'});
                </script>
            </div>
            <div class="trade_div">
                <button type="button" id="toggleButton">Îß§Ïàò/Îß§ÎèÑ</button>
                <form id="tradeForm">
                    <input type="hidden" id="isin" name="isin" value="">
                    <input type="hidden" id="id" name="id" value="<%=session.getAttribute("id")%>">
                    <div class="left-column">
                        <div class="form-group">
                            <label for="availableFunds">Ï£ºÎ¨∏ Í∞ÄÎä•</label>
                            <input type="text" id="availableFunds" name="availableFunds" value="0 KRW" readonly>
                        </div>
                        <div class="form-group">
                            <label for="price">Îß§Ïàò Í∞ÄÍ≤©</label>
                            <input type="text" id="price" name="price" placeholder="1000 KRW" readonly>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="form-group">
                            <label for="orderQuantity">Ï£ºÎ¨∏ ÏàòÎüâ</label>
                            <input type="text" id="orderQuantity" name="orderQuantity" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="quantityPercent">Ï£ºÎ¨∏ ÎπÑÏú®</label>
                            <div class="percent-buttons">
                                <button type="button" id="10percent">10%</button>
                                <button type="button" id="25percent">25%</button>
                                <button type="button" id="50percent">50%</button>
                                <button type="button" id="100percent">100%</button>
                            </div>
                        </div>
                    </div>
                    <div class="last-column">
                        <div class="form-group">
                            <label for="totalOrder">Ï£ºÎ¨∏ Ï¥ùÏï°</label>
                            <input type="text" id="totalOrder" name="totalOrder" readonly>
                        </div>
                        <input type="button" id="buyButton" value="Îß§ÏàòÌïòÍ∏∞">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<%@ include file="include/footer.jsp" %>
</div>
</body>
<script>
    getUserCash("<%=session.getAttribute("id")%>");

    // Í≤ÄÏÉâÏ∞Ω
    $(document).ready(function () {
        $('.search-box').on('input', function () {
            var input = $('.search-box').val();
            $.ajax({
                url: '/stock-searching',  // API endpoint
                type: 'GET',
                data: {
                    'input': input
                },
                success: function (data) {
                    var resultHtml = '';
                    for (var i = 0; i < data.length; i++) {
                        resultHtml += '<div>' + data[i].name + '</div>'; // Assuming 'name' is a property of Stock
                    }
                    $('.search-result').html(resultHtml).show();
                },
                error: function (data) {
                },
            });
        });

        $(document).click(function (event) {
            if (!$(event.target).closest('.searchBar').length) {
                $('.search-result').hide();
            }
        });

        $(document).on('click', '.search-result div', function () {
            $('.search-box').val($(this).text());
        });
    });

    // Í≤ÄÏÉâ Î≤ÑÌäº Ìò∏Ï∂ú Ïãú ÎèôÏûë
    function handleSearch() {
        const input = $('.search-box').val();
        $.ajax({
            url: "/stock-search",
            type: "GET",
            data: {
                'input': input
            },
            success: function (stock) {
                getChartData(stock.isin);
                $('.stock').text(stock.name + '(' + stock.isin + ')');
                document.getElementById('isin').value = stock.isin;
            },
            error: function () {
                console.log("Error occurred.");
            },
        });
    }

    function getChartData(isin) {
        $.ajax({
            url: "/get-chart",
            type: "GET",
            contentType: "application/json",
            data: {
                'input': isin
            },
            success: function (data) {
                const ohlcvList = JSON.parse(data);
                const candleData = ohlcvList.map((item) => ({
                    close: item.close,
                    high: item.high,
                    low: item.low,
                    open: item.open,
                    time: new Date(item.s_date).toISOString().split('T')[0],
                }));
                // Ï∞®Ìä∏Î•º Í∑∏Î¶º
                candlestickSeries.setData(candleData);

                // isin Ìèº Í∞í ÎåÄÏûÖ
                document.getElementById('isin').value = isin;

                // Îß§Ïàò/Îß§ÎèÑ Í∞ÄÍ≤© ÌèºÏóê Ï¢ÖÍ∞Ä Ï†ÅÏö©
                const PriceInput = document.getElementById('price');
                if (candleData.length > 0) {
                    const latestClose = Math.floor(candleData[candleData.length - 1].close); // ÏÜåÏàòÏ†ê Ï†úÍ±∞
                    PriceInput.value = latestClose.toString(); // Ï†ïÏàòÎ°ú Î≥ÄÌôòÌïòÏó¨ Î¨∏ÏûêÏó¥Î°ú ÌëúÏãú
                    price = PriceInput.value;
                } else {
                    PriceInput.value = ''; // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ Îπà Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                    price = '';
                }

                // Ï£ºÎ¨∏ Í∞ÄÎä• ÌèºÏóê ÏÇ¨Ïö©Ïûê ÏãúÎìúÎ•º Í≥†Î†§Ìïú ÏµúÎåÄ Ï£ºÎ¨∏ Í∞ÄÎä• Ïï°Ïàò Ï†ÅÏö©
                const buyMaxPrice = document.getElementById('availableFunds');
                if (cash < PriceInput.value) {
                    buyMaxPrice.value = 0;
                } else {
                    buyMaxPrice.value = Math.floor(cash / PriceInput.value) * PriceInput.value;
                }

                // Îß§ÎèÑÏùò Í≤ΩÏö∞, ÏµúÎåÄ Ï£ºÎ¨∏ ÏàòÎüâÏùÑ Î≥¥Ïú†ÌïòÍ≥† ÏûàÎäî Ï£ºÏãù Ïàò ÏÑ§Ï†ï

                //
            },
            error: function () {
                alert("Error occurred.");
            },
        });
    }

    // ÏÇ¨Ïö©Ïûê ÏßÄÍ∞ë
    function getUserCash(id) {
        $.ajax({
            url: '/get-user-cash',
            type: 'GET',
            data: {
                id: id // ÎåÄÏ≤¥Ìï† ÏÇ¨Ïö©Ïûê ÏãùÎ≥ÑÏûê
            },
            success: function (data) {
                // ÏöîÏ≤≠Ïù¥ ÏÑ±Í≥µÌñàÏùÑ ÎïåÏùò Ï≤òÎ¶¨
                cash = data;
                console.log('Received cash:', data);
                // data Î≥ÄÏàòÏóê ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏïÑÏò® cash Í∞íÏù¥ Îì§Ïñ¥ ÏûàÏäµÎãàÎã§.
                // Ïù¥Î•º ÏõêÌïòÎäî Î∞©ÏãùÏúºÎ°ú Ï≤òÎ¶¨ÌïòÏã≠ÏãúÏò§.
            },
            error: function (xhr, status, error) {
                // ÏöîÏ≤≠Ïù¥ Ïã§Ìå®ÌñàÏùÑ ÎïåÏùò Ï≤òÎ¶¨
                console.error('Error:', error);
            }
        });
    }


    function bindEventListeners() {
        document.getElementById('orderQuantity').addEventListener('input', function () {
            const orderQuantity = document.getElementById('orderQuantity').value;
            const price = document.getElementById('price').value;

            if (orderQuantity && price && orderQuantity * price > 0) {
                const totalOrder = orderQuantity * price;
                document.getElementById('totalOrder').value = totalOrder;
            } else {
                document.getElementById('totalOrder').value = '0 KRW';
            }
        });

        ['10', '25', '50', '100'].forEach(function (percent) {
            document.getElementById(percent + 'percent').addEventListener('click', function () {
                const availableFunds = Number(document.getElementById('availableFunds').value.replace(' KRW', ''));
                const price = Number(document.getElementById('price').value.replace(' KRW', ''));

                if (price) {
                    const orderQuantity = (availableFunds * (percent / 100)) / price;
                    const orderQuantityInput = document.getElementById('orderQuantity');

                    orderQuantityInput.value = Math.floor(orderQuantity);
                    orderQuantityInput.dispatchEvent(new Event('input'));
                }
            });
        });

        handleSearch();

        // Îß§Ïàò Ìä∏ÎûúÏû≠ÏÖò
        $(document).ready(function () {
            $("#buyButton").click(function (event) {
                event.preventDefault();

                var availableFunds = parseInt($("#availableFunds").val());
                var totalOrder = parseInt($("#totalOrder").val());

                if (isNaN(availableFunds) || isNaN(totalOrder)) {
                    alert("Ï£ºÎ¨∏ Í∞ÄÎä•Ìïú Í∏àÏï°Ïù¥ÎÇò Ï£ºÎ¨∏ Ï¥ùÏï°Ïù¥ Ïú†Ìö®Ìïú Ïà´ÏûêÍ∞Ä ÏïÑÎãôÎãàÎã§.");
                    return;
                }

                if (totalOrder <= availableFunds) {
                    var buyDto = {
                        isin: $('#isin').val(),  // Ï¢ÖÎ™©Î™ÖÏùÑ ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                        id: $('#id').val(),  // ÏÇ¨Ïö©Ïûê ÏïÑÏù¥ÎîîÎ•º ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                        price: parseInt($('#price').val()),  // Îß§ÏàòÍ∞ÄÎ•º ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                        volume: parseInt($('#orderQuantity').val()),  // ÏàòÎüâÏùÑ ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                    };

                    $.ajax({
                        type: 'POST',
                        url: '/buy-transaction',
                        data: JSON.stringify(buyDto),
                        contentType: 'application/json',
                        success: function () {
                            alert('Transaction success!');
                            location.reload();
                        },
                        error: function () {
                            alert('Transaction failed!');
                            // location.reload();
                        },
                    });
                } else {
                    alert("Ï£ºÎ¨∏ Í∞ÄÎä•Ìïú Í∏àÏï°Î≥¥Îã§ Ï£ºÎ¨∏ Ï¥ùÏï°Ïù¥ Îçî ÌÅΩÎãàÎã§.");
                }
            });
        });

        // Îß§ÎèÑ Ìä∏ÎûúÏû≠ÏÖò
        $(document).ready(function () {
            $("#sellButton").click(function (event) {
                event.preventDefault();

                var sellDto = {
                    isin: $('#isin').val(),  // Ï¢ÖÎ™©Î™ÖÏùÑ ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                    id: $('#id').val(),  // ÏÇ¨Ïö©Ïûê ÏïÑÏù¥ÎîîÎ•º ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                    price: parseInt($('#price').val()),  // Îß§ÎèÑÍ∞ÄÎ•º ÌèºÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§.
                };
                $.ajax({
                    type: 'POST',
                    url: '/sell-transaction',  // Îß§ÎèÑ ÏöîÏ≤≠ÏùÑ Ï≤òÎ¶¨ÌïòÎäî ÏÑúÎ≤ÑÏùò URLÏûÖÎãàÎã§.
                    data: JSON.stringify(sellDto),
                    contentType: 'application/json',
                    success: function () {
                        alert('Transaction success!');
                        location.reload();
                    },
                    error: function () {
                        console.log($('#isin').val());
                        console.log($('#id').val());
                        console.log(parseInt($('#price').val()));
                        alert('Transaction failed!');
                        //location.reload();
                    },
                });
            });
        });
    }

    function getTransactionVolume(id, isin) {
        $.ajax({
            type: "GET",
            url: "/sumHasVolume",
            data: {
                id: id,
                isin: isin
            },
            success: function (response) {
                // ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑúÎ≤ÑÏóêÏÑú ÏùëÎãµÏùÑ Î∞õÏïòÏùÑ Îïå Ïã§ÌñâÎêòÎäî ÏΩúÎ∞± Ìï®Ïàò
                console.log("Transaction volume:", response);
                document.getElementById("orderQuantity").value = response;
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            }
        });
    }


    // Îß§Ïàò/Îß§ÎèÑ Ìèº Î≥ÄÍ≤Ω
    var toggleButton = document.getElementById("toggleButton");
    var tradeForm = document.getElementById("tradeForm");
    var isBuyForm = true;
    toggleButton.addEventListener("click", function () {
        const isin = document.getElementById("isin").value;
        const priceInput = document.getElementById("price").value;
        console.log(isin);
        console.log(priceInput);
        if (isBuyForm) {
            tradeForm.innerHTML = `
                    <input type="hidden" id="isin" name="isin" value="">
                    <input type="hidden" id="id" name="id" value="<%=session.getAttribute("id")%>">
                    <div class="left-column">
                        <div class="form-group">
                            <label for="price">Îß§ÎèÑ Í∞ÄÍ≤©</label>
                            <input type="text" id="price" name="price" placeholder="1000 KRW" readonly>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="form-group">
                            <label for="orderQuantity">Îß§ÎèÑ ÏàòÎüâ</label>
                            <input type="text" id="orderQuantity" name="orderQuantity" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group" hidden>
                        <label for="quantityPercent" hidden>Ï£ºÎ¨∏ ÎπÑÏú®</label>
                        <div class="percent-buttons" hidden>
                            <button type="button" id="10percent" hidden>10%</button>
                            <button type="button" id="25percent" hidden>25%</button>
                            <button type="button" id="50percent" hidden>50%</button>
                            <button type="button" id="100percent" hidden>100%</button>
                        </div>
                    </div>
                    <div class="last-column">
                        <div class="form-group" hidden>
                            <label for="totalOrder" hidden>Ï£ºÎ¨∏ Ï¥ùÏï°</label>
                            <input type="text" id="totalOrder" name="totalOrder" readonly hidden>
                        </div>
                        <input type="button" id="sellButton" value="Îß§ÎèÑÌïòÍ∏∞">
                    </div>
                `;
            toggleButton.innerText = "Îß§ÏàòÌïòÍ∏∞";
            getTransactionVolume("<%=session.getAttribute("id")%>", isin);
        } else {
            tradeForm.innerHTML = `
                    <input type="hidden" id="isin" name="isin" value="">
                    <input type="hidden" id="id" name="id" value="<%=session.getAttribute("id")%>">
                    <div class="left-column">
                        <div class="form-group">
                            <label for="availableFunds">Ï£ºÎ¨∏ Í∞ÄÎä•</label>
                            <input type="text" id="availableFunds" name="availableFunds" value="0 KRW" readonly>
                        </div>
                        <div class="form-group">
                            <label for="price">Îß§Ïàò Í∞ÄÍ≤©</label>
                            <input type="text" id="price" name="price" placeholder="1000 KRW" readonly>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="form-group">
                            <label for="orderQuantity">Ï£ºÎ¨∏ ÏàòÎüâ</label>
                            <input type="text" id="orderQuantity" name="orderQuantity" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="quantityPercent">Ï£ºÎ¨∏ ÎπÑÏú®</label>
                            <div class="percent-buttons">
                                <button type="button" id="10percent">10%</button>
                                <button type="button" id="25percent">25%</button>
                                <button type="button" id="50percent">50%</button>
                                <button type="button" id="100percent">100%</button>
                            </div>
                        </div>
                    </div>
                    <div class="last-column">
                        <div class="form-group">
                            <label for="totalOrder">Ï£ºÎ¨∏ Ï¥ùÏï°</label>
                            <input type="text" id="totalOrder" name="totalOrder" readonly>
                        </div>
                        <input type="button" id="buyButton" value="Îß§ÏàòÌïòÍ∏∞">
                    </div>
                `;
            toggleButton.innerText = "Îß§ÎèÑÌïòÍ∏∞";
        }
        isBuyForm = !isBuyForm;
        document.getElementById("isin").value = isin;
        document.getElementById("price").value = priceInput;
        bindEventListeners();
    });

    $(document).ready(function () {
        // Ï¢ÖÎ™©Ï∂îÍ∞Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        $('h2:contains("Ï¢ÖÎ™©Ï∂îÍ∞Ä")').on('click', function () {
            // Ï¢ÖÎ™© Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            var stockInfo = $('.stock').text().trim(); // "ÏÇºÏÑ±Ï†ÑÏûê(005930)"

            // Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú Ï¢ÖÎ™©Ïù∏ÏßÄ ÌôïÏù∏
            var isAlreadyAdded = false;
            $('.stock_name > li').each(function () {
                if ($(this).text().indexOf(stockInfo) >= 0) { // Ï¢ÖÎ™© Ïù¥Î¶ÑÍ≥º Î≤àÌò∏Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                    isAlreadyAdded = true;
                    return false; // each loop ÌÉàÏ∂ú
                }
            });

            // Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú Ï¢ÖÎ™©Ïù¥ÎùºÎ©¥ Ï∂îÍ∞ÄÌïòÏßÄ ÏïäÏùå
            if (isAlreadyAdded) return;

            // Ï¢ÖÍ∞Ä, Îì±ÎùΩÎ•† Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ (ÏùºÎã® ÎåÄÍ∏∞)
            /*
            var closingPrice = '69,500'; // ÏûÑÏãú Í∞í
            var fluctuationRate = '-0.57%'; // ÏûÑÏãú Í∞í
            */
            // Î¶¨Ïä§Ìä∏ ÏöîÏÜå Ï∂îÍ∞Ä
            var newListItem = $(
                '<ul class="stock_name">' +
                '<li>' + stockInfo + '<i class="arrow fas fa-angle-right"></i></li>' +
                /*
                '<ul class="small_menu">' +
                '<li>' + closingPrice + ' <span class="blue_text"> ' + fluctuationRate + '</span></li>' +
                '</ul>' +*/
                '</ul>'
            );

            $('.add_stock').append(newListItem);

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            newListItem.on('click', 'li', function () {
                var name = $(this).text().trim().split('(')[0].replace(')', ''); // Ï¢ÖÎ™© Î™Ö Ï∂îÏ∂ú
                var isin = $(this).text().trim().split('(')[1].replace(')', ''); // Ï¢ÖÎ™© Î≤àÌò∏(ISIN) Ï∂îÏ∂ú
                $('.stock').text(name + '(' + isin + ')');
                getChartData(isin); // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            });
        });

        // 'Ï∂îÏ≤úÏ¢ÖÎ™©' Î¶¨Ïä§Ìä∏Ïùò Ìï≠Î™©Ïóê ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
        $('.stock_name').on('click', 'li', function () {
            // ÌÅ¥Î¶≠Ìïú Ìï≠Î™©Ïùò 'Ï¢ÖÎ™©Î≤àÌò∏' Î¶¨Ïä§Ìä∏ÏóêÏÑú text Ï∂îÏ∂ú
            var isin = $(this).parent().find('.small_menu li').first().text().trim().split(' ')[1];
            // ÌÅ¥Î¶≠Ìïú Ìï≠Î™©Ïùò Ïù¥Î¶Ñ Ï∂îÏ∂ú
            var name = $(this).text().trim();
            // ÌäπÏ†ï DOM ÏöîÏÜåÏóê Ï¢ÖÎ™© Ïù¥Î¶ÑÍ≥º Î≤àÌò∏ ÏÑ§Ï†ï
            $('.stock').text(name + '(' + isin + ')');
            // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            getChartData(isin);
        });
    });
    bindEventListeners();


</script>
</html>